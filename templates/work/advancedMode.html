{% extends 'work/base.html' %}

{% block title %}Advanced Mode{% endblock %}

{% block content %}

<style>
    #chatbot {
        margin-left: auto;
        margin-right: auto;
        width: 70%;
        margin-top: 50px;
        border-radius: 10px;
        border: 1px solid gray;
        padding: 10px;
        max-height: 300px;
        overflow-y: auto;
    }

    .botText, .userText {
        font-family: monospace;
        font-size: 14px;
        line-height: 25px;
        color: rgb(109, 111, 109);
    }

    .userText {
        text-align: right;
    }

    #userInput {
        margin-left: auto;
        margin-right: auto;
        width: 70%;
        margin-top: 40px;
        text-align: center;
    }

    #textInput {
        border: 3px solid white;
        border-bottom: 3px solid #afafaf;
        font-family: monospace;
        font-size: 14px;
        width: 60%;
        padding: 16px;
        color: rgb(213, 67, 41);
        outline: none;
    }

    #buttonInput {
        padding: 5px;
        font-family: monospace;
        font-size: 14px;
        border: solid 3px #5b605c;
        background-color: rgb(40, 48, 40);
        color: white;
        border-radius: 10px;
        cursor: pointer;
    }

    h1 {
        text-align: center;
        color: rgb(57, 72, 57);
    }
</style>

<h1>Advanced Mode</h1>

<div id="chatbot">
    <p class="botText"><span>Hi there!</span></p>
</div>

<div id="userInput">
    <input type="text" name="userMessage" placeholder="Type your message..." id="textInput">
    <input type="submit" value="Send" id="buttonInput" disabled>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    function getUserResponse() {
        var userText = $("#textInput").val().trim();
        if (userText === "") return; // Prevent empty input

        var userHTML = "<p class='userText'>User: <span>" + userText + "</span></p>";
        $("#chatbot").append(userHTML);
        $("#textInput").val("").focus(); // Clear input and focus

        $.get(window.location.pathname + "getResponse", { userMessage: userText }).done(function (data) {
            var returnedMessage = "<p class='botText'>Chatbot: <span>" + data + "</span></p>";
            $("#chatbot").append(returnedMessage);
            $("#chatbot").scrollTop($("#chatbot")[0].scrollHeight); // Auto-scroll
        });

        $("#buttonInput").prop("disabled", true); // Disable button after sending
    }

    $(document).ready(function () {
        $("#textInput").on("input", function () {
            $("#buttonInput").prop("disabled", $(this).val().trim() === "");
        });

        $("#buttonInput").click(getUserResponse);

        $("#textInput").keypress(function (event) {
            if (event.which === 13 && !$("#buttonInput").prop("disabled")) { // Enter key
                event.preventDefault();
                getUserResponse();
            }
        });
    });
</script>

{% endblock %}
